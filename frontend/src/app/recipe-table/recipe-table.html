<mat-drawer-container autosize>
    <!-- Side Drawer -->
    <mat-drawer #drawer position="end" mode="side">
      <div class="drawer-content" *ngIf="selected as r; else empty">
        <h2 class="drawer-title">{{ r.title }}</h2>
  
        <div class="kv"><label>Cuisine</label><div>{{ r.cuisine || '—' }}</div></div>
        <div class="kv"><label>Rating</label><div>{{ r.rating ?? '—' }}</div></div>
        <div class="kv"><label>Total Time</label><div>{{ r.total_time ?? '—' }} min</div></div>
  
        <div class="section">
          <h3>Prep & Cook Time</h3>
          <div class="kv"><label>Prep</label><div>{{ r.prep_time ?? '—' }} min</div></div>
          <div class="kv"><label>Cook</label><div>{{ r.cook_time ?? '—' }} min</div></div>
        </div>
  
        <mat-divider></mat-divider>
  
        <div class="section">
          <h3>Description</h3>
          <div class="desc">{{ r.description || '—' }}</div>
        </div>
  
        <mat-divider></mat-divider>
  
        <div class="section">
          <h3>Nutrients</h3>
          <table class="mat-mdc-table mdc-data-table__table" *ngIf="r.nutrients; else noNut">
            <tr><td>Calories</td><td>{{ r.nutrients['calories'] ?? '—' }}</td></tr>
            <tr><td>Carbs</td><td>{{ r.nutrients['carbohydrateContent'] ?? '—' }}</td></tr>
            <tr><td>Cholesterol</td><td>{{ r.nutrients['cholesterolContent'] ?? '—' }}</td></tr>
            <tr><td>Fiber</td><td>{{ r.nutrients['fiberContent'] ?? '—' }}</td></tr>
            <tr><td>Protein</td><td>{{ r.nutrients['proteinContent'] ?? '—' }}</td></tr>
            <tr><td>Saturated Fat</td><td>{{ r.nutrients['saturatedFatContent'] ?? '—' }}</td></tr>
            <tr><td>Sodium</td><td>{{ r.nutrients['sodiumContent'] ?? '—' }}</td></tr>
            <tr><td>Sugar</td><td>{{ r.nutrients['sugarContent'] ?? '—' }}</td></tr>
            <tr><td>Total Fat</td><td>{{ r.nutrients['fatContent'] ?? '—' }}</td></tr>
          </table>
          <ng-template #noNut><div class="empty">No nutrient data</div></ng-template>
        </div>
      </div>
  
      <ng-template #empty>
        <div class="empty">Select a recipe</div>
      </ng-template>
    </mat-drawer>
  
    <!-- Main Content -->
    <div class="main-container">
      <h1>Recipes</h1>
  
      <!-- Filters -->
      <div class="filters">
        <mat-form-field appearance="outline">
          <mat-label>Title</mat-label>
          <input matInput [(ngModel)]="f_title" (keyup.enter)="search()">
        </mat-form-field>
  
        <mat-form-field appearance="outline">
          <mat-label>Cuisine</mat-label>
          <input matInput [(ngModel)]="f_cuisine" (keyup.enter)="search()">
        </mat-form-field>
  
        <mat-form-field appearance="outline">
          <mat-label>Max Rating</mat-label>
          <input matInput type="number" step="0.1" [(ngModel)]="f_ratingVal" (keyup.enter)="search()">
        </mat-form-field>
  
        <mat-form-field appearance="outline">
          <mat-label>Max Total Time (min)</mat-label>
          <input matInput type="number" [(ngModel)]="f_totalVal" (keyup.enter)="search()">
        </mat-form-field>
  
        <mat-form-field appearance="outline">
          <mat-label>Max Calories</mat-label>
          <input matInput type="number" [(ngModel)]="f_calVal" (keyup.enter)="search()">
        </mat-form-field>
      </div>
  
      <!-- Buttons -->
      <div class="actions">
        <button mat-flat-button color="primary" (click)="search()">
          <mat-icon>search</mat-icon> Search
        </button>
        <button mat-stroked-button (click)="clearFilters()">
          <mat-icon>clear</mat-icon> Clear
        </button>
      </div>
  
      <!-- Loading -->
      <div *ngIf="loading" class="loading">
        <mat-spinner></mat-spinner>
      </div>
  
      <!-- Empty -->
      <div *ngIf="!loading && (data?.length ?? 0) === 0" class="empty">
        <p>No recipes found.</p>
      </div>
  
      <!-- Table -->
      <table *ngIf="!loading && (data?.length ?? 0) > 0"
             mat-table [dataSource]="data"
             class="mat-elevation-z1 full-width">
  
        <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef> Title </th>
          <td mat-cell *matCellDef="let r">
            <span class="table-title" (click)="open(r)">{{ r.title }}</span>
          </td>
        </ng-container>
  
        <ng-container matColumnDef="cuisine">
          <th mat-header-cell *matHeaderCellDef> Cuisine </th>
          <td mat-cell *matCellDef="let r"> {{ r.cuisine || '—' }} </td>
        </ng-container>
  
        <ng-container matColumnDef="rating">
          <th mat-header-cell *matHeaderCellDef> Rating </th>
          <td mat-cell *matCellDef="let r"> {{ r.rating ?? '—' }} </td>
        </ng-container>
  
        <ng-container matColumnDef="total_time">
          <th mat-header-cell *matHeaderCellDef> Total Time </th>
          <td mat-cell *matCellDef="let r"> {{ r.total_time ?? '—' }} </td>
        </ng-container>
  
        <ng-container matColumnDef="serves">
          <th mat-header-cell *matHeaderCellDef> Serves </th>
          <td mat-cell *matCellDef="let r"> {{ r.serves || '—' }} </td>
        </ng-container>
  
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
  
      <!-- Paginator -->
      <mat-paginator *ngIf="!loading && (data?.length ?? 0) > 0"
                     [length]="total"
                     [pageIndex]="page"
                     [pageSize]="limit"
                     [pageSizeOptions]="limits"
                     (page)="onPage($event)">
      </mat-paginator>
    </div>
  </mat-drawer-container>
  